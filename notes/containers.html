<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2025-01-13" />
  <title>Containers</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="../style.css" />
<link rel="stylesheet" href="../light.css" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="../dark.css" media="(prefers-color-scheme: dark)">
<script src="../dark.js"></script>
<script src="../toggle.js" defer></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="dark.js" async defer></script>
</head>
<body>
  <nav class="row row-gap row-start row-stretch" id="nav_margin">
    <div class="row">
      <div class="medium_spacer space_navbar"></div>
      <div>&nbsp;</div>
      <div class="small_spacer space_navbar"></div>
    </div>
    <a class="flatbutton row row-start" href="../index.html">
      <div class="square_icon"></div><div>HOME</div>
    </a>
    <a class="flatbutton row row-start" href="../notes.html">
      <div class="square_icon"></div><div>ARCHIVE</div>
    </a>
    <a class="flatbutton row row-start" href="../notes.html" aria-current="page">
      <div class="square_icon"></div><div>NOTES</div>
    </a>
    <a class="flatbutton row row-start" href="../about.html">
      <div class="square_icon"></div><div>ABOUT</div>
    </a>
    <button id="toggle_theme" class="row align_self_end" aria-label="Cycle between light, auto, and dark theme">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon auto" fill="currentColor" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="128" y1="32" x2="128" y2="224" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="192" y1="56.45" x2="192" y2="199.55" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="160" y1="37.47" x2="160" y2="218.53" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon sun" fill="currentColor" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><path d="M120,40V16a8,8,0,0,1,16,0V40a8,8,0,0,1-16,0Zm8,24a64,64,0,1,0,64,64A64.07,64.07,0,0,0,128,64ZM58.34,69.66A8,8,0,0,0,69.66,58.34l-16-16A8,8,0,0,0,42.34,53.66Zm0,116.68-16,16a8,8,0,0,0,11.32,11.32l16-16a8,8,0,0,0-11.32-11.32ZM192,72a8,8,0,0,0,5.66-2.34l16-16a8,8,0,0,0-11.32-11.32l-16,16A8,8,0,0,0,192,72Zm5.66,114.34a8,8,0,0,0-11.32,11.32l16,16a8,8,0,0,0,11.32-11.32ZM48,128a8,8,0,0,0-8-8H16a8,8,0,0,0,0,16H40A8,8,0,0,0,48,128Zm80,80a8,8,0,0,0-8,8v24a8,8,0,0,0,16,0V216A8,8,0,0,0,128,208Zm112-88H216a8,8,0,0,0,0,16h24a8,8,0,0,0,0-16Z"/></svg>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon moon" fill="currentColor" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><path d="M235.54,150.21a104.84,104.84,0,0,1-37,52.91A104,104,0,0,1,32,120,103.09,103.09,0,0,1,52.88,57.48a104.84,104.84,0,0,1,52.91-37,8,8,0,0,1,10,10,88.08,88.08,0,0,0,109.8,109.8,8,8,0,0,1,10,10Z"/></svg>
    </button>
  </nav>
<main class="content">
<header id="title-block-header">
<h1 class="title">Containers</h1>
<div class="date row row-start">
<svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="currentColor" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><rect x="40" y="40" width="176" height="176" rx="8" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="176" y1="24" x2="176" y2="56" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="80" y1="24" x2="80" y2="56" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="40" y1="88" x2="216" y2="88" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><circle cx="128" cy="132" r="12"/><circle cx="172" cy="132" r="12"/><circle cx="84" cy="172" r="12"/><circle cx="128" cy="172" r="12"/><circle cx="172" cy="172" r="12"/></svg>
<div>&nbsp;</div>
<p>
2025-01-13
</p>
</div>
</header>
<h1 id="containers">Containers</h1>
<p>Containers are used to isolate processes from a host system. The
isolation can include the filesystem, network, processes, and resources.
While containers can also be used for security reasons, a VM is more
secure but at the cost of performance and overhead. Containers on the
other hand, avoids the performance issues by relying on the host for
resources, but using native OS features to restrict access.</p>
<h2 id="chroot">Chroot</h2>
<p>Chroot, short for change root, restricts the filesystem, only
allowing a certain view of the filesystem. Injection of files and
directories can be done through read-only mounts.</p>
<p>See: <code>chroot</code></p>
<h2 id="namespaces">Namespaces</h2>
<p>However, processes inside the chroot can still access and manipulate
processes outside. Namespaces provides isolation for the process tree,
network, and mounts. Multiple namespaces can be created and join, to
allow for example, sharing some resources from the host.</p>
<p>For example, there are <code>PID</code> and <code>network</code>
namespaces to isolate the process tree and network stack
respectively.</p>
<p>See: <code>unshare</code>, <code>nsenter</code></p>
<h2 id="cgroups">Cgroups</h2>
<p>Cgroups, short for control groups, allow restricting resources, such
as memory or cpu, used by the container, and kills the processes as
needed.</p>
<p>Cgroups and their configuration can be found under
<code>/sys/fs/cgroup/</code>. The PIDs of which the cgroup is applied to
is in the the
<code>/sys/fs/cgroup/cgroup_name/cgroup_config_name/task</code>
file.</p>
<h2 id="capabilities">Capabilities</h2>
<p>Capabilities are like split-off powers of root and provides
fine-grained controls of what a process can do when using root. It goes
without saying that for containers, the less dangerous capabilities are
granted, the better.</p>
<p>See: <code>capsh</code></p>
<h2 id="seccomp">Seccomp</h2>
<p>Seccomp, short for secure computing, restricts what system calls a
process can make. This is even more restrictive then capabilities.</p>
<h2 id="linux-security-modules">Linux Security Modules</h2>
<p>Abbreiviated as LSMs, are as their name implies, a series of modules
for Linux to support security policies and modules.</p>
<h3 id="mandatory-access-controls">Mandatory Access Controls</h3>
<p>MAC, for short, restrict what could be accessed by a process,
program, or threads. The restriction can be applied to files,
directories, networks, memory, or devices. Attributes can be assigned to
the restriction, such as read-only or write-only.</p>
<p>Under Linux, <code>tomoyo</code>, <code>apparmor</code>,
<code>selinux</code> are the prominent MACs. Apparmor operates on path
while Selinux operates on inodes. Tomoyo is similar to Apparmor, but
includes a self-learning profile stage where it attempts to creates
restriction itself.</p>
<h3 id="more">More</h3>
<p><code>landlock</code>, <code>lockdown</code>, <code>yama</code>,
<code>integrity</code>, <code>bpf</code></p>
<h2 id="references">References</h2>
<p><a
href="https://ericchiang.github.io/post/containers-from-scratch/">Containers
from scratch</a> <a
href="https://www.lucavall.in/blog/barco-linux-containers-from-scratch-in-c">barco:
Linux Containers From Scratch in C</a> <a
href="https://www.panoptica.app/research/7-ways-to-escape-a-container">7
Ways to Escape a Container</a></p>
</main>
</body>
</html>
